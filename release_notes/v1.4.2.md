# Humidor v1.4.2 Release Notes

**Release Date:** December 17, 2025

## ğŸ¯ Overview

Version 1.4.2 is a focused maintenance release that fixes a critical bug preventing wish list cigars from being moved to humidors and enhances the transfer workflow with new UX improvements for better usability.

---

## ğŸ› Bug Fixes

### Wish List to Humidor Transfer

**Critical Fix: Transfer Operations Now Work Correctly**

Fixed a blocking issue where users couldn't move cigars from their wish list to a humidor:

- **Symptom**: 400 Bad Request or 405 Method Not Allowed errors when clicking "Move to Humidor"
- **Root Cause**: Date format mismatch between frontend and backend
  - Frontend sent date-only string: `"2025-12-17"`
  - Backend expected RFC3339 datetime: `"2025-12-17T15:22:05.123Z"`
- **Solution**: Updated `purchase_date` to use full ISO datetime format with timezone
- **Impact**: Wish list functionality fully restored

**Technical Details:**
- Changed JavaScript from `.toISOString().split('T')[0]` to `.toISOString()`
- Backend validation now passes correctly for `DateTime<Utc>` type
- No migration needed - format change is transparent to stored data

---

## âœ¨ New Features & Enhancements

### Enhanced Wish List Transfer Workflow

**Quantity Input**
- New quantity field in "Move to Humidor" modal
- Default value: 1
- Allows specifying how many cigars to purchase when moving from wish list
- Validation: Minimum 1 cigar required

**Auto-Populated Purchase Date**
- Purchase date automatically set to today's date when moving from wish list
- No manual date entry needed for fresh purchases
- Uses system time with full datetime precision

**Smart Field Disabling**
- Quantity and purchase date fields automatically disable/gray out when "Wish List" is selected
- Prevents invalid data entry for wish list items
- Clear visual feedback showing which fields are applicable

**Improved Modal Design**
- Better spacing and padding throughout the modal
- Enhanced form group margins for readability
- Cleaner label styling with proper hierarchy
- More polished visual appearance

**Visual Improvements**
- Updated "Move to Humidor" button with treasure chest icon (ğŸ“¦ â†’ ğŸ†)
- Better icon consistency across the interface
- Clearer visual affordance for transfer actions

---

## ğŸ¨ User Experience

### Before & After

**Before v1.4.2:**
- Transfer from wish list failed with error
- No quantity selection when moving cigars
- Manual purchase date entry required
- Basic modal layout
- Generic box emoji on button

**After v1.4.2:**
- âœ… Transfer works reliably
- âœ… Quantity selector available
- âœ… Purchase date auto-filled
- âœ… Smart field disabling
- âœ… Polished modal design
- âœ… Professional icon usage

### Workflow Enhancement

Moving a cigar from wish list to humidor is now streamlined:

1. Click "Move to Humidor" button (with treasure chest icon)
2. Select destination humidor from dropdown
3. Enter quantity (defaults to 1)
4. Purchase date automatically set to today
5. Click "Move to Humidor" - done!

The system handles the rest: cigar is added to selected humidor with proper quantity and purchase date, then removed from wish list.

---

## ğŸ”§ Technical Changes

### Frontend Updates

**JavaScript Changes (`app.js`)**
- `moveCigarToHumidor()`: Updated date handling to use full ISO format
- `showHumidorSelectionModal()`: Added quantity input field
- Field disabling logic: Changed from text-based detection to value-based (`.value === 'WISH_LIST'`)
- Modal styling: Inline styles for padding, margins, and spacing

**No Breaking Changes**
- All changes are backward compatible
- Existing cigar data unaffected
- No API changes required

### Backend Compatibility

**No Server Changes Required**
- Backend was already expecting RFC3339 format
- Frontend now conforms to existing API contract
- Validation logic unchanged

---

## ğŸ“‹ Testing & Quality Assurance

All pre-push checks passed:
- âœ… Code formatting (`cargo fmt`)
- âœ… Linting (`cargo clippy -- -D warnings`)
- âœ… 132 tests passed
- âœ… Security audit (1 allowed warning - indirect dependency)
- âœ… Container scan (Trivy) - 0 vulnerabilities

---

## ğŸš€ Upgrade Instructions

### Docker

```bash
docker-compose down
docker-compose up --build -d
```

### Cache Clearing

After update, perform a hard refresh in your browser:
- **Windows/Linux**: Ctrl + Shift + R
- **Mac**: Cmd + Shift + R

This ensures you get the latest JavaScript with bug fixes.

---

## ğŸ“ Known Issues

None identified in this release.

---

## ğŸ”— Related Issues

- Fixed: Wish list transfer returns 400/405 error
- Enhanced: Wish list to humidor workflow needs quantity input
- Improved: Modal styling and user feedback

---

## ğŸ“¦ Files Changed

### Modified
- `Cargo.toml` - Version bump to 1.4.2
- `CHANGELOG.md` - Release notes added
- `static/app.js` - Date format fix, quantity input, field disabling logic
- `src/handlers/cigars.rs` - Debug logging (temporary, will remove in future release)

### Added
- `release_notes/v1.4.2.md` - This file

---

## ğŸ‰ Conclusion

Version 1.4.2 restores critical wish list functionality while enhancing the user experience with thoughtful UX improvements. The transfer workflow is now more intuitive and reliable.

Thank you for using Humidor! ğŸš¬ğŸ“¦
