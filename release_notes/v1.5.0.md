# Humidor v1.5.0 Release Notes

**Release Date:** December 17, 2025

## ğŸ¯ Overview

Version 1.5.0 is a significant UX improvement release that replaces all browser-native dialogs with beautifully styled modals matching the app's design language. This release also includes critical fixes for mobile password manager support and implements proper alphabetical cigar sorting.

---

## âœ¨ New Features

### Styled Modal System

**Complete UI Overhaul for Confirmations and Inputs**

All browser-native dialogs (`alert`, `confirm`, `prompt`) have been replaced with custom styled modals:

- **Input Modal**
  - Used for restock quantity input
  - Matches app design with proper padding, margins, and typography
  - Better mobile experience with touch-optimized buttons
  - Accessible with keyboard navigation (Enter to confirm, Escape to cancel)

- **Confirmation Modal**
  - Used for all delete and action confirmations
  - Consistent styling across the entire application
  - Clear visual hierarchy with descriptive titles
  - Professional appearance vs. generic browser alerts

**Affected Actions:**
- ğŸ”„ Restock cigar quantity
- ğŸ—‘ï¸ Delete cigars
- ğŸ—‘ï¸ Delete humidors
- ğŸ—‘ï¸ Delete organizers
- â¤ï¸ Remove favorites
- ğŸ“ Remove from wish list
- ğŸ‘¥ Admin user actions (suspend/activate)
- ğŸ”— Revoke share access
- ğŸ”— Delete share links
- ğŸ”— Revoke all public shares

**Before:**
- Generic browser popups with system fonts
- Inconsistent styling across different browsers/devices
- Poor mobile experience

**After:**
- âœ… Beautiful, branded modals
- âœ… Consistent across all browsers and devices
- âœ… Proper spacing and typography
- âœ… Touch-optimized for mobile
- âœ… Keyboard accessible

---

## ğŸ› Bug Fixes

### iOS Password Manager Support

**Critical Fix: Password Managers Now Work in PWA**

Fixed a blocking issue preventing iOS password managers from working in the PWA:

- **Problem**: Login form had `autocomplete="username"` on an `<input type="email">` field
- **Impact**: iOS password managers (iCloud Keychain, 1Password, LastPass, etc.) didn't recognize the login form
- **Solution**: Changed to `autocomplete="email"` to match the input type
- **Result**: Password managers now correctly offer saved credentials on iOS devices

**Affected Platforms:**
- iOS Safari (PWA mode)
- iOS Chrome (PWA mode)
- All iOS password manager apps

### Cigar Sorting Order

**Fixed: Cigars Now Display Alphabetically**

Implemented proper sorting for cigars in the main humidor view:

**Sorting Logic:**
1. **Active status** (active cigars first)
2. **Brand name** (A-Z alphabetically)
3. **Cigar name** (A-Z alphabetically when brands match)

**Example Sort Order:**
- **Active Cigars:**
  - AJ Fernandez - New World
  - Arturo Fuente - Hemingway
  - Arturo Fuente - Opus X
  - CAO - Brazilia
  - Cohiba - Behike
  - Drew Estate - Liga Privada
  
- **Out of Stock Cigars:**
  - Oliva - Nub Connecticut
  - Oliva - Serie G
  - Romeo y Julieta - 1875

**Before:** Cigars displayed in API/database order (creation date)
**After:** Cigars sorted alphabetically by brand, then name

---

## ğŸ¨ User Experience Improvements

### Modal Dialog Enhancements

**Proper Spacing and Layout**
- Modal body: 2rem padding for comfortable reading
- Message text: 1.5rem bottom margin for visual breathing room
- Input fields: Full width with 0.75rem padding
- Footer buttons: 1rem gap between Cancel and OK buttons
- Consistent color scheme using CSS variables

**Accessibility**
- Keyboard navigation (Tab, Enter, Escape)
- Focus management (input auto-focuses on open)
- Clear visual feedback on hover/active states
- Proper ARIA labels and roles

**Mobile Optimization**
- Touch-friendly button sizes
- Optimized for narrow screens
- Prevents awkward system dialog overlays
- Consistent experience across devices

---

## ğŸ”§ Technical Changes

### Frontend Updates

**New Modal Infrastructure**
- Added `inputModal` and `confirmModal` HTML components
- Created `showInputModal()` helper function (returns Promise)
- Created `showConfirmModal()` helper function (returns Promise)
- All modals use async/await pattern for cleaner code

**Updated Functions:**
- `restockCigar()` - Now uses `showInputModal()`
- `deleteCigar()` - Now uses `showConfirmModal()`
- `deleteHumidor()` - Now uses `showConfirmModal()`
- `deleteOrganizer()` - Now uses `showConfirmModal()`
- `removeFavorite()` - Now uses `showConfirmModal()`
- `deleteWishListCigar()` - Now uses `showConfirmModal()`
- `toggleUserActive()` - Now uses `showConfirmModal()`
- `revokeShare()` - Now uses `showConfirmModal()`
- `deletePublicShare()` - Now uses `showConfirmModal()`
- `revokeAllPublicShares()` - Now uses `showConfirmModal()`

**Sorting Implementation**
- `renderCigars()` function now sorts before rendering
- Sorting preserves active/inactive segregation
- Case-insensitive alphabetical comparison
- Handles missing brand names gracefully

**Files Modified:**
- `static/index.html` - Added modal HTML components
- `static/app.js` - Added modal helpers, updated all dialog calls, implemented sorting
- `static/login.html` - Fixed autocomplete attribute

---

## ğŸ“‹ Testing & Quality Assurance

All pre-push checks passed:
- âœ… Code formatting (`cargo fmt`)
- âœ… Linting (`cargo clippy -- -D warnings`)
- âœ… 132 tests passed
- âœ… Security audit (1 allowed warning - indirect dependency)

---

## ğŸš€ Upgrade Instructions

### Docker

```bash
docker-compose down
docker-compose up --build -d
```

### PWA Cache Clearing

The service worker has been updated to v1.5.0. To ensure you get the new modals:

**On Desktop:**
1. Hard refresh: Ctrl + Shift + R (Windows/Linux) or Cmd + Shift + R (Mac)

**On Mobile (iOS/Android):**
1. Close the PWA completely (swipe up from app switcher)
2. Reopen the PWA - service worker will update in background
3. Close and reopen again to load new version

**Or:**
1. Uninstall the PWA from home screen
2. Clear browser cache in Safari/Chrome settings
3. Reinstall the PWA

---

## ğŸ“ Known Issues

None identified in this release.

---

## ğŸ‰ What's Next

Potential future enhancements:
- Additional sorting options (by size, strength, origin)
- User-configurable sort preferences
- More modal types (multi-step wizards, rich content)
- Enhanced mobile gestures

---

## ğŸ”— Related Issues

- Fixed: iOS password managers not working in PWA
- Fixed: Cigars not sorted alphabetically
- Enhanced: Replaced all browser dialogs with styled modals
- Improved: Modal spacing and padding

---

## ğŸ“¦ Files Changed

### Modified
- `Cargo.toml` - Version bump to 1.5.0
- `static/sw.js` - Version bump to 1.5.0
- `CHANGELOG.md` - Release notes added
- `static/index.html` - Added inputModal and confirmModal components with proper styling
- `static/app.js` - Added modal helpers, replaced all prompts/confirms, implemented sorting
- `static/login.html` - Fixed autocomplete attribute for password managers

### Added
- `release_notes/v1.5.0.md` - This file

---

## ğŸ’¡ Migration Notes

**For Developers:**
- All `prompt()` calls replaced with `await showInputModal(title, message, defaultValue)`
- All `confirm()` calls replaced with `await showConfirmModal(title, message)`
- Both return Promises - use `await` for cleaner async code
- Modal functions automatically handle cleanup and event listeners

**For Users:**
- No breaking changes
- All features work the same, just with better UI
- iOS password managers now work correctly
- Cigars display in a more logical order

---

## ğŸ™ Conclusion

Version 1.5.0 brings significant polish to the user experience with professionally styled modals, fixes critical mobile functionality, and implements proper sorting throughout the app. The UI now feels more cohesive and native, especially on mobile devices.

Thank you for using Humidor! ğŸš¬âœ¨
