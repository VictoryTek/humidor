# Humidor v1.2.1 Release Notes

**Release Date:** December 7, 2025

## üéØ Overview

Version 1.2.1 is a patch release that fixes responsive layout issues discovered after the v1.2.0 PWA release. This update ensures proper layout behavior across all screen resolutions, particularly at breakpoint boundaries.

## üêõ Bug Fixes

### Desktop Layout Fix
- **Search/Filter Bar Positioning**: Fixed issue where search and filter bar was appearing on a separate row below the header on desktop resolutions
- **Expected Behavior**: On desktop/wide screens, the search bar stays inline with "My Humidors" title and "+ HUMIDOR" button
- **Mobile Behavior**: On mobile (‚â§768px), search bar correctly moves to a separate row below the header
- **Impact**: Restores proper three-column grid layout on desktop (`auto 1fr auto`)

### Hamburger Menu Alignment
- **Menu Button Position**: Fixed hamburger menu jumping above the logo at 769px screen width
- **Root Cause**: Base `.header-left` style lacked flexbox display properties, causing vertical stacking at certain resolutions
- **Solution**: Added `display: flex`, `align-items: center`, and `gap: 0.75rem` to base header-left style
- **Impact**: Hamburger menu now stays properly positioned left of logo at all screen sizes between tablet (769px) and desktop (1024px+)

### Wish List Cigar Editing
- **Issue**: Users received "Failed to fetch" error (ERR_EMPTY_RESPONSE) when trying to edit cigars in their wish list
- **Root Cause**: `verify_cigar_ownership()` function only checked cigar ownership through humidors table join, missing cigars with NULL `humidor_id` or cigars in wish list
- **Solution**: Added wish list ownership check - queries `wish_list` table to verify if user owns the cigar through their wish list
- **Impact**: Users can now successfully view and edit details of cigars in their wish list

## üîß Technical Details

### CSS Changes

**File**: `static/styles.css`

1. **Page Actions Header Grid**
   - Added explicit `grid-row: 1` to `.page-title`, `.cigar-search-section-inline`, and `.header-actions`
   - Ensures all three elements stay on first row in desktop view
   - Mobile media query (‚â§768px) overrides with `grid-row: 2` for search section

2. **Header Left Flexbox**
   - Base `.header-left` now includes full flexbox properties
   - Consistent layout behavior from mobile to desktop
   - Prevents element stacking at breakpoint boundaries

### Rust Backend Changes

**File**: `src/handlers/cigars.rs`

1. **Wish List Ownership Check**
   - Added query to check if cigar exists in user's `wish_list` table
   - Executes after humidor ownership check but before shared humidor check
   - Returns `Ok(())` if user owns cigar through wish list
   - Query: `SELECT EXISTS(SELECT 1 FROM wish_list WHERE cigar_id = $1 AND user_id = $2)`

2. **Humidor ID Handling**
   - Changed `humidor_id` from `Uuid` to `Option<Uuid>` in ownership verification
   - Properly handles cigars with NULL `humidor_id` (wish list items)
   - Only checks shared humidor permissions if `humidor_id` is Some(uuid)

### Service Worker
- Updated cache version to `humidor-v1.2.1`
- Automatic cache cleanup on update
- Users will receive update notification after deployment

## üìä Testing

- **Manual Testing**: Verified layout at 768px, 769px, 1024px, and 1920px resolutions
- **Browser Testing**: Chrome, Edge, Firefox, Safari
- **Device Testing**: Desktop, tablet simulation, mobile simulation
- **All Tests**: 132/132 passing (no test changes required)

## üöÄ Deployment

### Update Process
1. Users with v1.2.0 installed will see update notification within 1 hour
2. Click "Update Now" to reload with v1.2.1
3. Old caches automatically cleared
4. Layout fixes applied immediately

### Backwards Compatibility
- Fully compatible with v1.2.0
- No database changes
- No API changes
- Pure CSS fixes

## üì± Affected Features

### Fixed Layouts
- ‚úÖ Desktop humidor page header (title, search, button alignment)
- ‚úÖ Mobile/tablet navigation menu (hamburger positioning)
- ‚úÖ All responsive breakpoints (768px, 769px, 1024px)
- ‚úÖ Wish list cigar editing (GET /api/v1/cigars/:id now works for wish list items)

### Unaffected Features
- ‚úÖ PWA installation and offline functionality
- ‚úÖ Service worker caching strategies
- ‚úÖ Mobile responsive grids and cards
- ‚úÖ Touch targets and mobile optimizations
- ‚úÖ All API endpoints and data operations

## üìö Version Comparison

| Component | v1.2.0 | v1.2.1 |
|-----------|---------|---------|
| Cargo.toml | 1.2.0 | 1.2.1 |
| Service Worker | humidor-v1.2.0 | humidor-v1.2.1 |
| Desktop Layout | Bug: Search on new row | Fixed: Three-column grid |
| Menu @ 769px | Bug: Menu above logo | Fixed: Menu beside logo |
| Cache Strategy | ‚úÖ Working | ‚úÖ Working |
| PWA Features | ‚úÖ Working | ‚úÖ Working |

## üéØ Resolution Behavior

### Desktop (>1024px)
- Three-column header grid: Title | Search/Filters | Button
- Hamburger menu hidden, sidebar visible
- All elements on single row

### Tablet (769px - 1024px)
- Hamburger menu visible beside logo ‚úÖ **FIXED**
- Three-column header grid maintained ‚úÖ **FIXED**
- Sidebar slides out when opened

### Mobile (‚â§768px)
- Hamburger menu beside logo (smaller)
- Two-row header: Title+Button | Search/Filters
- Single column content layout

## üîç Known Issues

None identified in this release.

## üôè Acknowledgments

Thanks to users who tested v1.2.0 and reported layout issues at specific breakpoints.

---

**Previous Version:** [v1.2.0](v1.2.0.md) - PWA Implementation

**Full Changelog:** See [CHANGELOG.md](../CHANGELOG.md)

**Tests:** 132/132 passing ‚úÖ

**Ready for Production:** ‚úÖ
