# Humidor v1.5.2 Release Notes

**Release Date:** December 20, 2025

## üêõ Bug Fix Release

Version 1.5.2 is a focused bug fix release addressing visual and functionality issues discovered in v1.5.1. This release fixes light mode styling, external image loading, and settings UI alignment issues.

---

## üîß Bug Fixes

### Light Mode Cigar Details Modal

**Complete Light Mode Styling for Report Cards**

The Cigar Details modal (report card) now displays correctly in light mode with proper theming:

**What Was Fixed:**
- Modal background changed from dark gradient to light theme colors
- All text, labels, and headers now use light mode text colors
- Info boxes (cigar details grid) use light backgrounds
- Notes section properly styled with light theme
- Retail link section themed for light mode
- Close button and action buttons (Edit, Delete) styled appropriately
- Scrollbars use light theme colors

**Impact:**
- Users in light mode no longer see dark-themed modal
- Consistent visual experience across entire app
- All text remains readable with proper contrast
- Premium design aesthetic maintained in both themes

**Technical Details:**
- Added comprehensive `:root.light-mode` overrides for `.report-card-content`
- Used CSS custom properties for dynamic theming
- Maintains dark mode functionality unchanged

---

### External Cigar Image Loading

**Fixed Placeholder Images on Initial Load**

External cigar images from user-provided URLs now load correctly on first page visit:

**The Problem:**
- Service worker was intercepting external image requests
- CORS restrictions prevented caching of external images
- Images showed placeholder on initial load
- Required hard browser refresh to see actual images

**The Solution:**
- Service worker now bypasses external images entirely
- External images (from cigarsinternational.com, etc.) load directly
- Browser handles CORS naturally without SW interference
- Local images (logo, placeholder) still cached for offline use

**What Works Now:**
- ‚úÖ External cigar images load immediately on first visit
- ‚úÖ No placeholder shown when image URL is valid
- ‚úÖ No hard refresh required
- ‚úÖ Local assets still cached for offline support
- ‚úÖ Fast loading with no CORS errors

**Technical Details:**
- Updated service worker to v1.5.3
- Added origin check: `url.origin === self.location.origin`
- Local images use cache-first strategy
- External images bypass service worker completely

---

### Settings Section Headers Alignment

**Fixed Unintended Right-Alignment of Section Headers**

Settings section headers are now correctly left-aligned:

**The Problem:**
- All settings section headers had `justify-content: space-between`
- This caused headers like "User Management" and "Backup & Restore" to spread content awkwardly
- Icon and text were pushed to opposite ends

**The Solution:**
- Removed `justify-content: space-between` from base `.section-title` class
- Added specific rule for `.about-section .section-title` only
- Install App button remains right-aligned in About Humidor section only

**Visual Impact:**
```
Before:
[Icon]                    User Management   [spread out awkwardly]

After:
[Icon] User Management                      [properly grouped]
[Icon] About Humidor              [Install App]  [button on right]
```

**Affected Sections:**
- ‚úÖ User Management - now left-aligned
- ‚úÖ Backup & Restore - now left-aligned  
- ‚úÖ About Humidor - Install App button stays right-aligned
- ‚úÖ All other settings sections - properly aligned

---

### Rapid Quantity Counter Updates

**Enabled Fast Clicking on +/- Quantity Buttons**

Quantity buttons on cigar cards now respond to rapid clicking:

**The Problem:**
- Clicking +/- buttons required waiting for API response between clicks
- Users couldn't quickly add multiple cigars (e.g., bought 5 more)
- Each click passed stale quantity value from render time
- Frustrating UX for common inventory updates

**The Solution:**
- Added `data-quantity` attribute to all cigar cards for live tracking
- Implemented 500ms debouncing to batch API calls
- Optimistic UI updates show changes immediately
- Each click reads current quantity from data attribute
- Multiple rapid clicks accumulate properly

**What Works Now:**
- ‚úÖ Click +/- buttons as fast as you want
- ‚úÖ UI updates immediately without waiting
- ‚úÖ API calls batched (500ms debounce window)
- ‚úÖ Accurate quantity tracking with data attributes
- ‚úÖ Reduced server load from batching
- ‚úÖ Toast notification shows final quantity
- ‚úÖ Works in all views (humidors, favorites)

**Example:**
```
User Action: Click + five times quickly
Old Behavior: 1 ‚Üí wait ‚Üí 2 ‚Üí wait ‚Üí 3 (slow, frustrating)
New Behavior: 1 ‚Üí 2 ‚Üí 3 ‚Üí 4 ‚Üí 5 (instant feedback, one API call)
```

**Technical Details:**
- Added `pendingQuantityChanges` Map for debouncing
- Cards track quantity with `data-quantity` attribute
- `updateCigarCardInDOM` updates both DOM and data attribute
- Debounce timeout: 500ms (half second)
- Optimistic updates with error handling

---

## üìù Files Changed

### Frontend
- `static/styles.css` - Light mode overrides, section header alignment
- `static/sw.js` - Service worker v1.5.3 with external image bypass
- `static/app.js` - Rapid quantity button clicking with debouncing

### Documentation
- `CHANGELOG.md` - Version 1.5.2 entry
- `release_notes/v1.5.2.md` - This file

---

## üîÑ Upgrade Notes

### Service Worker Update

The service worker will automatically update to v1.5.3:
- Users may see a brief "Update Available" notification
- Refresh the page to activate the new service worker
- No data loss or cache clearing required
- External images will load correctly after update

### Visual Changes

Users will notice:
- Light mode Cigar Details modal now properly themed
- Images load immediately without placeholders
- Settings headers better aligned

---

## üêõ Known Issues

None at this time.

---

## üìö Additional Resources

- [User Guide](../docs/USER_GUIDE.md)
- [API Documentation](../docs/API.md)
- [PWA Testing Guide](../docs/PWA_TESTING_GUIDE.md)

---

## üôè Acknowledgments

Thank you to our users for reporting these issues and helping improve Humidor!

---

**Full Changelog:** [v1.5.1...v1.5.2](../../compare/v1.5.1...v1.5.2)
